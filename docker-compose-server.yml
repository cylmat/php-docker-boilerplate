version: '3'

networks: 
    phpsrv:

volumes:
    app_volume:

services: 
    ##########
    # APACHE #
    ##########
    # https://httpd.apache.org/docs
    apache:
        image: httpd:${APACHE_VERSION}
        container_name: apache
        restart: always
        volumes:
            - ${APP_SOURCE}:/usr/local/apache2/htdocs

            # (Un)comment for your own config.
            - ${HOST_DIRECTORY}/.docker/server/apache/httpd.conf:/usr/local/apache2/conf/httpd.conf:ro
            - ${HOST_DIRECTORY}/.docker/server/apache/httpd-custom.conf:/usr/local/apache2/conf/httpd-custom.conf:ro
            - ${HOST_DIRECTORY}/.docker/server/apache/my-extra:/usr/local/apache2/conf/my-extra:ro
        ports: 
            - ${APACHE_PORT}:80
        networks:
            - ${NETWORK}

    #########
    # NGINX #
    #########
    # nginx:
    #     image: nginx:${NGINX_VERSION}
    #     container_name: nginx
    #     restart: always
    #     volumes:
    #         - ${APP_SOURCE}/public:/usr/share/nginx/html

    #         # (Un)comment for your own config.
    #         - ${HOST_DIRECTORY}/.docker/server/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    #         - ${HOST_DIRECTORY}/.docker/server/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf:ro
    #         #- /nginx/data/cache
    #     ports:
    #         - ${NGINX_PORT}:80
    #     networks: 
    #         - ${NETWORK}

    ###########
    # PHP-FPM # 
    ###########
    phpfpm: 
        image: php:8.1-fpm
        # build:
        #     context: .docker/phpfpm
        #     target: FULL
        container_name: phpfpm
        restart: always
        environment:
            - DB_USER=user
            - DB_PASS=pass
        volumes:
            - ${APP_SOURCE}:/var/www
            ### php
            - ${HOST_DIRECTORY}/.docker/server/phpfpm/php.ini:/usr/local/etc/php/php.ini:ro
            - ${HOST_DIRECTORY}/.docker/server/phpfpm/conf.d/php-ext-custom.ini:/usr/local/etc/php/conf.d/php-ext-custom.ini:ro
            - ${HOST_DIRECTORY}/.docker/server/phpfpm/fpm/www.conf:/usr/local/etc/php-fpm.d/www.conf:ro
        ports: 
            - 9000:9000
        expose:
            - 9000
        networks:
            - ${NETWORK}

    ############
    # Selenium # 
    ############
    # selenium:
    #     image: nkovacs/selenium-standalone-phantomjs:latest
    #     restart: always
    #     ports:
    #         - 4444:4444
    #         - 5900:5900
    #     volumes:
    #         - ${APP_SOURCE}:/appli
    #     networks: 
    #         - ${NETWORK}

######################
# Other useful boxes #
# https://devilbox.org
# https://easyphp.org
# https://laradock.io
# https://laragon.org
# https://github.com/laraedit/laraedit-docker
# https://hub.docker.com/r/mattrayner/lamp
######################
